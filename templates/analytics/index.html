<!-- templates/stock_prediction.html -->
{% load static %}
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI ì£¼ê°€ ë¶„ì„ ëŒ€ì‹œë³´ë“œ</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels"></script>
    <script src="https://cdn.jsdelivr.net/npm/gsap@3.12.2/dist/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/particles.js/2.0.0/particles.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <style>
        .gradient-bg {
            background: linear-gradient(120deg, #1a1a2e 0%, #16213e 100%);
        }

        .card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .prediction-card {
            transition: transform 0.3s ease;
        }

        .prediction-card:hover {
            transform: transla teY(-5px);
        }

        .ai-pulse {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.05);
            }
            100% {
                transform: scale(1);
            }
        }

        #particles-js {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
        }

        .container {
            position: relative;
            z-index: 1;
        }

        .glow-effect {
            box-shadow: 0 0 15px rgba(59, 130, 246, 0.5);
        }

        .data-point {
            animation: dataPointPulse 2s infinite;
        }

        @keyframes dataPointPulse {
            0% {
                transform: scale(1);
                opacity: 1;
            }
            50% {
                transform: scale(1.2);
                opacity: 0.7;
            }
            100% {
                transform: scale(1);
                opacity: 1;
            }
        }
    </style>
</head>
<body class="gradient-bg min-h-screen text-white">
<div id="particles-js"></div>
<div class="container mx-auto px-4 py-8">
    <div class="flex items-center justify-between mb-8">
        <h1 class="text-4xl font-bold">AI ì£¼ê°€ ë¶„ì„ ëŒ€ì‹œë³´ë“œ</h1>
        <div class="ai-pulse bg-blue-500 px-4 py-2 rounded-full">
            AI ì‹¤ì‹œê°„ ë¶„ì„ ì¤‘
        </div>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
        <div class="card p-6 rounded-xl prediction-card">
            <h3 class="text-xl font-semibold mb-4">ì˜ˆì¸¡ ì •í™•ë„</h3>
            <div class="text-4xl font-bold text-green-400">98.7%</div>
            <canvas id="accuracyChart" class="mt-4"></canvas>
        </div>
        <div class="card p-6 rounded-xl prediction-card">
            <h3 class="text-xl font-semibold mb-4">AI ì‹ ë¢°ë„</h3>
            <div class="text-4xl font-bold text-blue-400">95.2%</div>
            <canvas id="confidenceChart" class="mt-4"></canvas>
        </div>
        <div class="card p-6 rounded-xl prediction-card">
            <h3 class="text-xl font-semibold mb-4">ì‹œì¥ ë³€ë™ì„±</h3>
            <div class="text-4xl font-bold text-yellow-400">ì¤‘ê°„</div>
            <canvas id="volatilityChart" class="mt-4"></canvas>
        </div>
    </div>


    <div class="card p-6 rounded-xl">
        <h3 class="text-xl font-semibold mb-4">AI ë§¤ë§¤ ì‹ í˜¸</h3>
        <div id="trading-signal" class="space-y-4">
            <!-- ë§¤ë§¤ ì‹ í˜¸ê°€ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ í‘œì‹œë©ë‹ˆë‹¤ -->
        </div>
    </div>


    <div class="card p-8 rounded-xl mb-8">
        <h2 class="text-2xl font-bold mb-6">ì‹¤ì‹œê°„ ì£¼ê°€ ì˜ˆì¸¡</h2>
        <canvas id="predictionChart" height="50"></canvas>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <div class="card p-6 rounded-xl">
            <h3 class="text-xl font-semibold mb-4">AI ë¶„ì„ ì¸ì‚¬ì´íŠ¸</h3>
            <div class="space-y-4">
                <div class="flex items-center gap-3">
                    <span class="text-green-400">â–²</span>
                    <p>ìƒìŠ¹ ì¶”ì„¸ ì§€ì† ì˜ˆìƒ (ì‹ ë¢°ë„: 92%)</p>
                </div>
                <div class="flex items-center gap-3">
                    <span class="text-blue-400">â—</span>
                    <p>ê±°ë˜ëŸ‰ ì¦ê°€ ê°ì§€</p>
                </div>
                <div class="flex items-center gap-3">
                    <span class="text-yellow-400">!</span>
                    <p>ë‹¨ê¸° ì¡°ì • ê°€ëŠ¥ì„± ìˆìŒ</p>
                </div>
            </div>
        </div>
        <div class="card p-6 rounded-xl">
            <h3 class="text-xl font-semibold mb-4">ì‹œì¥ ì§€í‘œ</h3>
            <canvas id="marketIndicators"></canvas>
        </div>
    </div>
</div>

<div class="card p-8 rounded-xl mb-8">
    <div class="flex items-center justify-between mb-4">
        <h2 class="text-2xl font-bold">ì‹¤ì‹œê°„ AI ë¶„ì„ ë°ì´í„°</h2>
        <div class="flex gap-4">
            <div class="data-point px-4 py-2 bg-blue-500 rounded-full">
                ë°ì´í„° í¬ì¸íŠ¸: 1.2M
            </div>
            <div class="data-point px-4 py-2 bg-green-500 rounded-full">
                ì²˜ë¦¬ ì†ë„: 0.3ms
            </div>
        </div>
    </div>
    <div class="grid grid-cols-2 gap-4">
        <div class="glow-effect card p-4 rounded-xl">
            <canvas id="realtimeChart1"></canvas>
        </div>
        <div class="glow-effect card p-4 rounded-xl">
            <canvas id="realtimeChart2"></canvas>
        </div>
    </div>
</div>


<script>
    // ì„ì˜ì˜ ë°ì´í„° ìƒì„± í•¨ìˆ˜
    function generateRandomData(count) {
        return Array.from({length: count}, () => Math.random() * 100);
    }

    function generateTimeLabels(count) {
        const labels = [];
        for (let i = count; i > 0; i--) {
            labels.push(`${i}ë¶„ ì „`);
        }
        return labels;
    }

    // ì˜ˆì¸¡ ì •í™•ë„ ì°¨íŠ¸
    const accuracyChart = new Chart(document.getElementById('accuracyChart'), {
        type: 'line',
        data: {
            labels: generateTimeLabels(10),
            datasets: [{
                label: 'ì •í™•ë„ ì¶”ì´',
                data: generateRandomData(10).map(val => val * 0.99), // 90-99% ë²”ìœ„
                borderColor: '#34D399',
                tension: 0.4,
                fill: true,
                backgroundColor: 'rgba(52, 211, 153, 0.1)'
            }]
        },
        options: {
            responsive: true,
            scales: {
                y: {
                    min: 90,
                    max: 100
                }
            }
        }
    });

    // ì‹¤ì‹œê°„ ì£¼ê°€ ì˜ˆì¸¡ ì°¨íŠ¸
    const predictionChart = new Chart(document.getElementById('predictionChart'), {
        type: 'line',
        data: {
            labels: Array.from({length: 20}, (_, i) => `${i}ë¶„`), // 0ë¶„ë¶€í„° 19ë¶„ê¹Œì§€
            datasets: [{
                label: 'ì‹¤ì œ ê°€ê²©',
                data: Array(20).fill(null), // ì‹¤ì œ ê°€ê²© ë°ì´í„° (ì´ˆê¸°ê°’ null)
                borderColor: '#60A5FA',
                tension: 0.4
            }, {
                label: 'AI ì˜ˆì¸¡',
                data: Array(20).fill(null), // ì˜ˆì¸¡ ê°€ê²© ë°ì´í„° (ì´ˆê¸°ê°’ null)
                borderColor: '#F87171',
                tension: 0.4,
                borderDash: [5, 5]
            }]
        },
        options: {
            responsive: true,
            interaction: {
                intersect: false,
                mode: 'index'
            },
            plugins: {
                legend: {
                    position: 'top'
                }
            },
            scales: {
                x: {
                    title: {
                        display: true,
                        text: 'ì‹œê°„ (ë¶„)'
                    }
                }
            }
        }
    });

    // ì‹ ë¢°ë„ ì°¨íŠ¸
    const confidenceChart = new Chart(document.getElementById('confidenceChart'), {
        type: 'line',
        data: {
            labels: [],
            datasets: [{
                label: 'ì‹ ë¢°ë„ ì¶”ì´',
                data: [],
                borderColor: '#60A5FA',
                tension: 0.4,
                fill: true,
                backgroundColor: 'rgba(96, 165, 250, 0.1)'
            }]
        },
        options: {
            responsive: true,
            scales: {
                y: {
                    min: 0,
                    max: 100
                }
            }
        }
    });

    // ë³€ë™ì„± ì°¨íŠ¸
    const volatilityChart = new Chart(document.getElementById('volatilityChart'), {
        type: 'line',
        data: {
            labels: [],
            datasets: [{
                label: 'ë³€ë™ì„± ì¶”ì´',
                data: [],
                borderColor: '#FCD34D',
                tension: 0.4,
                fill: true,
                backgroundColor: 'rgba(252, 211, 77, 0.1)'
            }]
        },
        options: {
            responsive: true,
            scales: {
                y: {
                    beginAtZero: true
                }
            }
        }
    });

    function updateSignal(signal) {
        const signalContainer = document.getElementById('trading-signal');
        let signalColor, signalText, signalIcon;

        switch (signal.type) {
            case 'STRONG_BUY':
                signalColor = 'text-green-500';
                signalText = 'ê°•í•œ ë§¤ìˆ˜';
                signalIcon = 'ğŸ”¥';
                break;
            case 'BUY':
                signalColor = 'text-green-400';
                signalText = 'ë§¤ìˆ˜';
                signalIcon = 'â†—ï¸';
                break;
            case 'NEUTRAL':
                signalColor = 'text-gray-400';
                signalText = 'ì¤‘ë¦½';
                signalIcon = 'â¡ï¸';
                break;
            case 'SELL':
                signalColor = 'text-red-400';
                signalText = 'ë§¤ë„';
                signalIcon = 'â†˜ï¸';
                break;
            case 'STRONG_SELL':
                signalColor = 'text-red-500';
                signalText = 'ê°•í•œ ë§¤ë„';
                signalIcon = 'âš ï¸';
                break;
        }

        signalContainer.innerHTML = `
                <div class="flex items-center justify-between p-4 border border-gray-700 rounded-lg">
                    <div class="flex items-center gap-3">
                        <span class="text-2xl">${signalIcon}</span>
                        <div>
                            <p class="text-lg font-bold ${signalColor}">${signalText} ì‹ í˜¸</p>
                            <div class="text-sm text-gray-400 mt-1">
                                ${signal.reasons.map(reason => `<p>â€¢ ${reason}</p>`).join('')}
                            </div>
                        </div>
                    </div>
                </div>
            `;
    }

    function updateCharts(data) {
        const currentTime = new Date();

        // ì˜ˆì¸¡ ì°¨íŠ¸ ì—…ë°ì´íŠ¸
        // í˜„ì¬ ì‹œì ë¶€í„° ë¯¸ë˜ 5ë¶„ê¹Œì§€ì˜ ì˜ˆì¸¡ ê°€ê²© ê³„ì‚°
        const currentPrice = data.current_price;
        const predictedPrice = data.predicted_price;
        const priceGap = predictedPrice - currentPrice;
        const priceStep = priceGap / 5; // 5ë¶„ ë™ì•ˆì˜ ë‹¨ê³„ë³„ ë³€í™”ëŸ‰

        // ì‹¤ì œ ê°€ê²© ë°ì´í„° ì—…ë°ì´íŠ¸ (í˜„ì¬ ì‹œì ê¹Œì§€ì˜ ë°ì´í„°ë§Œ)
        const realPrices = predictionChart.data.datasets[0].data;
        realPrices.push(currentPrice);
        realPrices.shift();

        // ì˜ˆì¸¡ ê°€ê²© ë°ì´í„° ì—…ë°ì´íŠ¸ (í˜„ì¬ ì‹œì ë¶€í„° ë¯¸ë˜ 5ë¶„)
        const predictedPrices = predictionChart.data.datasets[1].data;
        for (let i = 15; i < 20; i++) {
            predictedPrices[i] = currentPrice + (priceStep * (i - 14));
        }
        predictedPrices[14] = currentPrice; // í˜„ì¬ ì‹œì 

        // ì •í™•ë„ ì°¨íŠ¸ ì—…ë°ì´íŠ¸
        accuracyChart.data.labels.push(currentTime);
        accuracyChart.data.datasets[0].data.push(data.accuracy);

        if (accuracyChart.data.labels.length > 10) {
            accuracyChart.data.labels.shift();
            accuracyChart.data.datasets[0].data.shift();
        }

        // ì‹ ë¢°ë„ ì°¨íŠ¸ ì—…ë°ì´íŠ¸
        confidenceChart.data.labels.push(currentTime);
        confidenceChart.data.datasets[0].data.push(data.confidence);

        if (confidenceChart.data.labels.length > 10) {
            confidenceChart.data.labels.shift();
            confidenceChart.data.datasets[0].data.shift();
        }

        // ë³€ë™ì„± ì°¨íŠ¸ ì—…ë°ì´íŠ¸
        volatilityChart.data.labels.push(currentTime);
        volatilityChart.data.datasets[0].data.push(data.market_scores.ë³€ë™ì„±);

        if (volatilityChart.data.labels.length > 10) {
            volatilityChart.data.labels.shift();
            volatilityChart.data.datasets[0].data.shift();
        }

        // ì°¨íŠ¸ ì—…ë°ì´íŠ¸
        predictionChart.update('none');
        accuracyChart.update('none');
        confidenceChart.update('none');
        volatilityChart.update('none');
        marketIndicators.update('none');

        // ì‹œì¥ ì§€í‘œ ì—…ë°ì´íŠ¸
        marketIndicators.data.datasets[0].data = Object.values(data.market_scores);

        // í™”ë©´ ìƒì˜ ê°’ë“¤ ì—…ë°ì´íŠ¸
        document.querySelector('.text-4xl.font-bold.text-green-400').textContent =
            `${data.accuracy.toFixed(1)}%`;
        document.querySelector('.text-4xl.font-bold.text-blue-400').textContent =
            `${data.confidence.toFixed(1)}%`;

        // ë³€ë™ì„± ìƒíƒœ ì—…ë°ì´íŠ¸
        const volatilityElement = document.querySelector('.text-4xl.font-bold.text-yellow-400');
        const volatility = data.market_scores.ë³€ë™ì„±;
        let volatilityText = 'ë‚®ìŒ';
        if (volatility > 66) volatilityText = 'ë†’ìŒ';
        else if (volatility > 33) volatilityText = 'ì¤‘ê°„';
        volatilityElement.textContent = volatilityText;

        // AI ì¸ì‚¬ì´íŠ¸ ì—…ë°ì´íŠ¸
        updateInsights(data);

        // ë§¤ë§¤ ì‹ í˜¸ ì—…ë°ì´íŠ¸ ì¶”ê°€
        updateSignal(data.signal);
    }

    function updateInsights(data) {
        const insightsContainer = document.querySelector('.space-y-4');
        const insights = [];

        // ì£¼ê°€ ì˜ˆì¸¡ ì¸ì‚¬ì´íŠ¸
        insights.push({
            color: data.predicted_change > 0 ? 'text-green-400' : 'text-red-400',
            symbol: data.predicted_change > 0 ? 'â–²' : 'â–¼',
            text: `${Math.abs(data.predicted_change)}% ${data.predicted_change > 0 ? 'ìƒìŠ¹' : 'í•˜ë½'} ì˜ˆìƒ (ì‹ ë¢°ë„: ${data.confidence.toFixed(1)}%)`
        });

        // ê±°ë˜ëŸ‰ ì¸ì‚¬ì´íŠ¸
        if (data.market_scores.ê±°ë˜ëŸ‰ > 70) {
            insights.push({
                color: 'text-blue-400',
                symbol: 'â—',
                text: 'ê±°ë˜ëŸ‰ ê¸‰ì¦ ê°ì§€'
            });
        }

        // ì¶”ê°€ ì¸ì‚¬ì´íŠ¸
        if (data.market_scores.íˆ¬ìì‹¬ë¦¬ > 70) {
            insights.push({
                color: 'text-yellow-400',
                symbol: '!',
                text: 'ê³¼ì—´ ì§•í›„ ê°ì§€'
            });
        }

        insightsContainer.innerHTML = insights.map(insight => `
                <div class="flex items-center gap-3">
                    <span class="${insight.color}">${insight.symbol}</span>
                    <p>${insight.text}</p>
                </div>
            `).join('');
    }

    // ì‹¤ì‹œê°„ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
    function fetchRealtimeData() {
        fetch('/analytics/api/realtime-predictions/')
            .then(response => response.json())
            .then(data => {
                updateCharts(data);
            })
            .catch(error => console.error('Error:', error));
    }

    // 10ì´ˆë§ˆë‹¤ ë°ì´í„° ì—…ë°ì´íŠ¸ (1ë¶„ì€ ë„ˆë¬´ ê¸¸ì–´ì„œ 10ì´ˆë¡œ ë³€ê²½)
    setInterval(fetchRealtimeData, 10000);
    // ì´ˆê¸° ë°ì´í„° ë¡œë“œ
    fetchRealtimeData();

    // ì‹œì¥ ì§€í‘œ ì°¨íŠ¸
    const marketIndicators = new Chart(document.getElementById('marketIndicators'), {
        type: 'radar',
        data: {
            labels: ['ê±°ë˜ëŸ‰', 'ë³€ë™ì„±', 'ì¶”ì„¸ê°•ë„', 'ë§¤ìˆ˜ì„¸', 'ê¸°ìˆ ì ì§€í‘œ', 'íˆ¬ìì‹¬ë¦¬'],
            datasets: [{
                label: 'í˜„ì¬ ì‹œì¥ ìƒíƒœ',
                data: generateRandomData(6),
                borderColor: '#808080',
                backgroundColor: 'rgba(128, 128, 128, 0.1)',
                borderWidth: 1
            }]
        },
        options: {
            responsive: true,
            scales: {
                r: {
                    beginAtZero: true,
                    max: 100
                }
            }
        }
    });

    // Particles.js ì„¤ì •
    particlesJS('particles-js',
        {
            "particles": {
                "number": {
                    "value": 80,
                    "density": {
                        "enable": true,
                        "value_area": 800
                    }
                },
                "color": {
                    "value": "#ffffff"
                },
                "opacity": {
                    "value": 0.1
                },
                "size": {
                    "value": 3
                },
                "line_linked": {
                    "enable": true,
                    "distance": 150,
                    "color": "#ffffff",
                    "opacity": 0.1,
                    "width": 1
                },
                "move": {
                    "enable": true,
                    "speed": 2
                }
            }
        }
    );
</script>
</body>
</html>